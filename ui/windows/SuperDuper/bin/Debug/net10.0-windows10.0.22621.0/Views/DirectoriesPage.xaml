<Page
    x:Class="SuperDuper.Views.DirectoriesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SuperDuper.Views"
    xmlns:vm="using:SuperDuper.ViewModels">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="280" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="1.5*" MinWidth="400" />
        </Grid.ColumnDefinitions>

        <!-- Column 0: Match list -->
        <Grid Grid.Column="0" Padding="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header with nesting roll-up toggle -->
            <Grid Grid.Row="0" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="Directory Comparison"
                           Style="{StaticResource TitleLargeTextBlockStyle}"
                           VerticalAlignment="Center" />
                <ToggleSwitch Grid.Column="1"
                              Header="Collapse nested"
                              IsOn="{Binding ViewModel.IsNestingRolledUp, Mode=TwoWay}"
                              VerticalAlignment="Center" />
            </Grid>

            <!-- TabView with Exact / Subset / Overlap tabs -->
            <TabView Grid.Row="1"
                     TabWidthMode="SizeToContent"
                     IsAddTabButtonVisible="False">

                <!-- Exact Matches tab -->
                <TabViewItem Header="{Binding ViewModel.ExactTabHeader, Mode=OneWay}">
                    <ScrollViewer>
                        <ItemsRepeater ItemsSource="{Binding ViewModel.ExactPairs, Mode=OneTime}">
                            <ItemsRepeater.Layout>
                                <StackLayout Spacing="8" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource CardBorderStyle}"
                                            Tag="{Binding}"
                                            PointerPressed="PairCard_PointerPressed">
                                        <StackPanel Spacing="6">
                                            <TextBlock Text="{Binding DirADisplayPath, Mode=OneTime}"
                                                       Style="{StaticResource PathTextStyle}" />
                                            <TextBlock Text="=" HorizontalAlignment="Center"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <TextBlock Text="{Binding DirBDisplayPath, Mode=OneTime}"
                                                       Style="{StaticResource PathTextStyle}" />
                                            <TextBlock Text="{Binding Summary, Mode=OneTime}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Button Content="Delete Left"
                                                        Command="{Binding DeleteLeftCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding DeleteLeftAccessibleName, Mode=OneTime}" />
                                                <Button Content="Delete Right"
                                                        Command="{Binding DeleteRightCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding DeleteRightAccessibleName, Mode=OneTime}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                </TabViewItem>

                <!-- Subsets tab -->
                <TabViewItem Header="{Binding ViewModel.SubsetTabHeader, Mode=OneWay}">
                    <ScrollViewer>
                        <ItemsRepeater ItemsSource="{Binding ViewModel.SubsetPairs, Mode=OneTime}">
                            <ItemsRepeater.Layout>
                                <StackLayout Spacing="8" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource CardBorderStyle}"
                                            Tag="{Binding}"
                                            PointerPressed="PairCard_PointerPressed">
                                        <StackPanel Spacing="6">
                                            <TextBlock Text="{Binding DirADisplayPath, Mode=OneTime}"
                                                       Style="{StaticResource PathTextStyle}" />
                                            <TextBlock Text="subset" HorizontalAlignment="Center"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <TextBlock Text="{Binding DirBDisplayPath, Mode=OneTime}"
                                                       Style="{StaticResource PathTextStyle}" />
                                            <TextBlock Text="{Binding Summary, Mode=OneTime}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Button Content="Delete Left"
                                                        Command="{Binding DeleteLeftCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding DeleteLeftAccessibleName, Mode=OneTime}" />
                                                <Button Content="Delete Right"
                                                        Command="{Binding DeleteRightCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding DeleteRightAccessibleName, Mode=OneTime}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                </TabViewItem>

                <!-- Overlaps tab -->
                <TabViewItem Header="{Binding ViewModel.OverlapTabHeader, Mode=OneWay}">
                    <ScrollViewer>
                        <ItemsRepeater ItemsSource="{Binding ViewModel.OverlapPairs, Mode=OneTime}">
                            <ItemsRepeater.Layout>
                                <StackLayout Spacing="8" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource CardBorderStyle}"
                                            Tag="{Binding}"
                                            PointerPressed="PairCard_PointerPressed">
                                        <StackPanel Spacing="6">
                                            <TextBlock Text="{Binding DirADisplayPath, Mode=OneTime}"
                                                       Style="{StaticResource PathTextStyle}" />
                                            <TextBlock Text="overlaps" HorizontalAlignment="Center"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <TextBlock Text="{Binding DirBDisplayPath, Mode=OneTime}"
                                                       Style="{StaticResource PathTextStyle}" />
                                            <TextBlock Text="{Binding Summary, Mode=OneTime}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Button Content="Delete Left"
                                                        Command="{Binding DeleteLeftCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding DeleteLeftAccessibleName, Mode=OneTime}" />
                                                <Button Content="Delete Right"
                                                        Command="{Binding DeleteRightCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding DeleteRightAccessibleName, Mode=OneTime}" />
                                                <Button Content="Review Differences"
                                                        Command="{Binding ReviewDifferencesCommand, Mode=OneTime}"
                                                        FontSize="12"
                                                        AutomationProperties.Name="{Binding ReviewDiffAccessibleName, Mode=OneTime}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                </TabViewItem>

            </TabView>
        </Grid>

        <!-- Column 1: Divider -->
        <Border Grid.Column="1" Width="1"
                Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

        <!-- Column 2: Side-by-side comparison -->
        <Grid Grid.Column="2" Padding="12"
              Visibility="{Binding ViewModel.HasSelectedPair, Mode=OneWay}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Summary bar -->
            <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,12">
                <TextBlock Text="{Binding ViewModel.ComparisonSummary, Mode=OneWay}"
                           Style="{StaticResource BodyStrongTextBlockStyle}" />
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Rectangle Width="12" Height="12" RadiusX="2" RadiusY="2"
                                   Fill="{ThemeResource SystemFillColorSuccessBrush}" />
                        <TextBlock Text="{Binding ViewModel.MatchedCountLabel, Mode=OneWay}"
                                   Style="{StaticResource CaptionTextBlockStyle}" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Rectangle Width="12" Height="12" RadiusX="2" RadiusY="2"
                                   Fill="{ThemeResource AccentFillColorDefaultBrush}" />
                        <TextBlock Text="{Binding ViewModel.LeftOnlyCountLabel, Mode=OneWay}"
                                   Style="{StaticResource CaptionTextBlockStyle}" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Rectangle Width="12" Height="12" RadiusX="2" RadiusY="2"
                                   Fill="{ThemeResource SystemFillColorCautionBrush}" />
                        <TextBlock Text="{Binding ViewModel.RightOnlyCountLabel, Mode=OneWay}"
                                   Style="{StaticResource CaptionTextBlockStyle}" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>

            <!-- Dual file lists -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!-- Left dir files -->
                <Grid Grid.Column="0" Margin="0,0,4,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="{Binding ViewModel.SelectedPairDirA, Mode=OneWay}"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               TextTrimming="CharacterEllipsis"
                               Margin="0,0,0,4" />
                    <ListView Grid.Row="1"
                              ItemsSource="{Binding ViewModel.LeftFiles, Mode=OneWay}"
                              SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnSpacing="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="16" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" Glyph="{Binding StatusIcon, Mode=OneTime}"
                                              FontSize="12" Foreground="{Binding StatusBrush, Mode=OneTime}" />
                                    <TextBlock Grid.Column="1" Text="{Binding FileName, Mode=OneTime}"
                                               TextTrimming="CharacterEllipsis" />
                                    <TextBlock Grid.Column="2" Text="{Binding FormattedSize, Mode=OneTime}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
                <!-- Right dir files -->
                <Grid Grid.Column="1" Margin="4,0,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="{Binding ViewModel.SelectedPairDirB, Mode=OneWay}"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               TextTrimming="CharacterEllipsis"
                               Margin="0,0,0,4" />
                    <ListView Grid.Row="1"
                              ItemsSource="{Binding ViewModel.RightFiles, Mode=OneWay}"
                              SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnSpacing="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="16" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" Glyph="{Binding StatusIcon, Mode=OneTime}"
                                              FontSize="12" Foreground="{Binding StatusBrush, Mode=OneTime}" />
                                    <TextBlock Grid.Column="1" Text="{Binding FileName, Mode=OneTime}"
                                               TextTrimming="CharacterEllipsis" />
                                    <TextBlock Grid.Column="2" Text="{Binding FormattedSize, Mode=OneTime}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>
