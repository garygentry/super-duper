<!-- DirectoryComparisonPage: Shows pairs of similar directories -->
<Page
    x:Class="SuperDuper.Views.DirectoryComparisonPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:SuperDuper.ViewModels">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <TextBlock Text="Directory Comparison" Style="{StaticResource TitleTextBlockStyle}" />
            <TextBlock Text="Directories with similar or identical content"
                       Style="{StaticResource SubtitleTextBlockStyle}" />
        </StackPanel>

        <!-- Controls -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="12" Margin="0,0,0,16">
            <TextBlock Text="Min similarity:" VerticalAlignment="Center" />
            <Slider Minimum="0.1" Maximum="1.0" StepFrequency="0.1"
                    Value="{x:Bind ViewModel.MinScore, Mode=TwoWay}"
                    Width="200" />
            <TextBlock Text="{x:Bind ViewModel.FormattedMinScore, Mode=OneWay}"
                       VerticalAlignment="Center" />
        </StackPanel>

        <!-- Similarity pairs list -->
        <ScrollViewer Grid.Row="2">
            <StackPanel Spacing="0">
                <!-- Empty state -->
                <TextBlock Text="No similar directories found at this similarity threshold."
                           Visibility="{x:Bind ViewModel.HasNoPairs, Mode=OneWay}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,32,0,0" />

                <ListView ItemsSource="{x:Bind ViewModel.SimilarPairs}"
                          SelectionMode="None">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="vm:SimilarPairViewModel">
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="8" Padding="16" Margin="0,4">
                                <Grid RowSpacing="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Directory paths -->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{x:Bind DirADisplayPath}" FontWeight="SemiBold"
                                                   FontFamily="Consolas" FontSize="12" TextWrapping="Wrap" />
                                        <TextBlock Text="{x:Bind DirBDisplayPath}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   FontFamily="Consolas" FontSize="12" TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!-- Stats -->
                                    <StackPanel Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right" Spacing="4">
                                        <TextBlock Text="{x:Bind MatchType}"
                                                   Style="{StaticResource BodyStrongTextBlockStyle}"
                                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
                                        <TextBlock Text="{x:Bind FormattedScore}" HorizontalAlignment="Right"
                                                   Style="{StaticResource BodyStrongTextBlockStyle}" />
                                        <TextBlock Text="{x:Bind FormattedSharedBytes}"
                                                   HorizontalAlignment="Right"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   FontSize="11" />
                                    </StackPanel>

                                    <!-- Mark for deletion buttons -->
                                    <StackPanel Grid.Row="1" Grid.ColumnSpan="2"
                                                Orientation="Horizontal" Spacing="8">
                                        <Button Content="Mark A for Deletion"
                                                Command="{x:Bind MarkAForDeletionCommand}"
                                                IsEnabled="{x:Bind IsDirANotMarked, Mode=OneWay}"
                                                FontSize="12" Padding="10,4" />
                                        <Button Content="Mark B for Deletion"
                                                Command="{x:Bind MarkBForDeletionCommand}"
                                                IsEnabled="{x:Bind IsDirBNotMarked, Mode=OneWay}"
                                                FontSize="12" Padding="10,4" />
                                        <TextBlock Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   Visibility="{x:Bind DirAMarked, Mode=OneWay}">
                                            ✓ A marked
                                        </TextBlock>
                                        <TextBlock Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   Visibility="{x:Bind DirBMarked, Mode=OneWay}">
                                            ✓ B marked
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Load More (only visible when more results are available) -->
                <Button Content="Load More"
                        Command="{x:Bind ViewModel.LoadNextPageCommand}"
                        Visibility="{x:Bind ViewModel.HasMoreResults, Mode=OneWay}"
                        HorizontalAlignment="Center"
                        Margin="0,8,0,0" />
            </StackPanel>
        </ScrollViewer>

        <ProgressRing Grid.Row="2"
                      IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                      Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
    </Grid>
</Page>
