<!-- MainPage: NavigationView shell with page-based navigation -->
<Page
    x:Class="SuperDuper.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SuperDuper.Views">

    <NavigationView
        x:Name="NavView"
        IsBackButtonVisible="Collapsed"
        IsSettingsVisible="True"
        PaneDisplayMode="Left"
        IsTitleBarAutoPaddingEnabled="False"
        SelectionChanged="NavView_SelectionChanged">

        <NavigationView.PaneHeader>
            <TextBlock Text="Super Duper"
                       Style="{StaticResource BodyStrongTextBlockStyle}"
                       Margin="8,0,0,0" VerticalAlignment="Center" />
        </NavigationView.PaneHeader>

        <NavigationView.MenuItems>
            <NavigationViewItem Content="Dashboard" Icon="Home" Tag="dashboard" IsSelected="True" />
            <NavigationViewItem Content="Duplicate Groups" Icon="Copy" Tag="duplicates" />
            <NavigationViewItem Content="Directory Comparison" Icon="Folder" Tag="directories" />
            <NavigationViewItem Content="Deletion Review" Icon="Delete" Tag="deletion" />
        </NavigationView.MenuItems>

        <Grid>
            <!-- Dashboard (inline, shown by default) -->
            <Grid x:Name="DashboardContent" Padding="24">
                <StackPanel Spacing="16">
                    <TextBlock Text="Super Duper" Style="{StaticResource TitleLargeTextBlockStyle}" />

                    <!-- Session picker row -->
                    <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                        <TextBlock Text="Session:"
                                   Style="{StaticResource BodyStrongTextBlockStyle}"
                                   VerticalAlignment="Center" />
                        <ComboBox ItemsSource="{x:Bind ViewModel.SessionPickerItems}"
                                  SelectedItem="{x:Bind ViewModel.SelectedSession, Mode=TwoWay}"
                                  DisplayMemberPath="DisplayLabel"
                                  MinWidth="380"
                                  IsEnabled="{x:Bind ViewModel.IsNotScanning, Mode=OneWay}" />
                    </StackPanel>

                    <!-- Stat cards -->
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="20">
                            <StackPanel>
                                <TextBlock Text="Files Scanned" Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock Text="{x:Bind ViewModel.TotalFilesScanned, Mode=OneWay}"
                                           Style="{StaticResource TitleLargeTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="20">
                            <StackPanel>
                                <TextBlock Text="Duplicate Groups" Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock Text="{x:Bind ViewModel.TotalDuplicateGroups, Mode=OneWay}"
                                           Style="{StaticResource TitleLargeTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="20">
                            <StackPanel>
                                <TextBlock Text="Wasted Space" Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock Text="{x:Bind ViewModel.FormattedWastedBytes, Mode=OneWay}"
                                           Style="{StaticResource TitleLargeTextBlockStyle}" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Post-scan summary -->
                    <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                    <!-- Scan paths configuration -->
                    <TextBlock Text="Scan Paths" Style="{StaticResource BodyStrongTextBlockStyle}"
                               Margin="0,8,0,0" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox x:Name="ScanPathInput"
                                 Text="{x:Bind ViewModel.NewScanPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="Enter folder path to scan..."
                                 MinWidth="380" />
                        <Button Content="Add"
                                Command="{x:Bind ViewModel.AddScanPathCommand}" />
                        <Button Content="Browse..." Click="BrowseFolderButton_Click" />
                    </StackPanel>

                    <ListView x:Name="ScanPathsList"
                              ItemsSource="{x:Bind ViewModel.ScanPaths}"
                              Tag="{x:Bind ViewModel.RemoveScanPathCommand}"
                              SelectionMode="None"
                              MaxHeight="150">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Left" />
                                <Setter Property="Padding" Value="0,2" />
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind}"
                                               VerticalAlignment="Center" />
                                    <Button Content="&#xE711;"
                                            FontFamily="{StaticResource SymbolThemeFontFamily}"
                                            Command="{Binding Tag, ElementName=ScanPathsList}"
                                            CommandParameter="{x:Bind}"
                                            Background="Transparent" BorderThickness="0"
                                            Padding="4" />
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Ignore patterns configuration -->
                    <TextBlock Text="Ignore Patterns" Style="{StaticResource BodyStrongTextBlockStyle}"
                               Margin="0,8,0,0" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox Text="{x:Bind ViewModel.NewIgnorePattern, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="e.g. **/node_modules/**"
                                 MinWidth="380" />
                        <Button Content="Add"
                                Command="{x:Bind ViewModel.AddIgnorePatternCommand}" />
                    </StackPanel>

                    <ListView x:Name="IgnorePatternsList"
                              ItemsSource="{x:Bind ViewModel.IgnorePatterns}"
                              Tag="{x:Bind ViewModel.RemoveIgnorePatternCommand}"
                              SelectionMode="None"
                              MaxHeight="120">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Left" />
                                <Setter Property="Padding" Value="0,2" />
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind}"
                                               VerticalAlignment="Center"
                                               FontFamily="Consolas" />
                                    <Button Content="&#xE711;"
                                            FontFamily="{StaticResource SymbolThemeFontFamily}"
                                            Command="{Binding Tag, ElementName=IgnorePatternsList}"
                                            CommandParameter="{x:Bind}"
                                            Background="Transparent" BorderThickness="0"
                                            Padding="4" />
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Not scanning: Start Scan button -->
                    <StackPanel Orientation="Horizontal" Spacing="8"
                                Visibility="{x:Bind ViewModel.IsNotScanning, Mode=OneWay}">
                        <Button Content="Start Scan"
                                Style="{StaticResource AccentButtonStyle}"
                                Command="{x:Bind ViewModel.StartScanCommand}" />
                    </StackPanel>

                    <!-- Scanning: progress card -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="8" Padding="16"
                            Visibility="{x:Bind ViewModel.IsScanning, Mode=OneWay}">
                        <Grid RowSpacing="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0">
                                <TextBlock Text="{x:Bind ViewModel.ScanPhaseLabel, Mode=OneWay}"
                                           Style="{StaticResource BodyStrongTextBlockStyle}"
                                           VerticalAlignment="Center"/>
                                <Button Content="Cancel" HorizontalAlignment="Right"
                                        Command="{x:Bind ViewModel.CancelScanCommand}"/>
                            </Grid>
                            <ProgressBar Grid.Row="1" Height="4"
                                         IsIndeterminate="{x:Bind ViewModel.ScanProgressIndeterminate, Mode=OneWay}"
                                         Maximum="{x:Bind ViewModel.ScanProgressMax, Mode=OneWay}"
                                         Value="{x:Bind ViewModel.ScanProgressValue, Mode=OneWay}"/>
                            <TextBlock Grid.Row="2"
                                       Text="{x:Bind ViewModel.ScanCountLabel, Mode=OneWay}"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>

            <!-- Frame for sub-pages (hidden by default) -->
            <Frame x:Name="SubPageFrame" Visibility="Collapsed" />
        </Grid>
    </NavigationView>
</Page>
