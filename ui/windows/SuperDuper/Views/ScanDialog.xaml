<ContentDialog
    x:Class="SuperDuper.Views.ScanDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:SuperDuper.ViewModels"
    xmlns:controls="using:SuperDuper.Controls"
    Title="New Scan"
    PrimaryButtonText="Start Scan"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    MinWidth="560">

    <!-- Grid lets ScanProgressOverlay stack on top of the Pivot -->
    <Grid>
        <Pivot x:Name="StepPivot"
               Visibility="{Binding ViewModel.IsNotScanning, Mode=OneWay}">

        <!-- Step 1: Confirm Targets (read-only; editing is on Dashboard) -->
        <PivotItem Header="1 · Targets">
            <ScrollViewer Padding="0,8">
                <StackPanel Spacing="12">
                    <TextBlock Text="The following locations will be scanned:"
                               Style="{StaticResource BodyTextBlockStyle}" />

                    <!-- Read-only path list -->
                    <ItemsRepeater ItemsSource="{Binding ViewModel.ScanPaths, Mode=OneTime}">
                        <ItemsRepeater.Layout>
                            <StackLayout Spacing="4" />
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnSpacing="4" Padding="4,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" Glyph="&#xE8B7;" FontSize="14"
                                              VerticalAlignment="Center" />
                                    <TextBlock Grid.Column="1" Text="{Binding}"
                                               Style="{StaticResource PathTextStyle}"
                                               VerticalAlignment="Center" Margin="8,0,0,0" />
                                </Grid>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>

                    <TextBlock Text="To change scan targets, close this dialog and edit them on the Dashboard."
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               FontStyle="Italic"
                               Margin="0,8,0,0" />
                </StackPanel>
            </ScrollViewer>
        </PivotItem>

        <!-- Step 2: Options -->
        <PivotItem Header="2 · Options">
            <ScrollViewer Padding="0,8">
                <StackPanel Spacing="16">
                    <NumberBox Header="Minimum file size (coming soon)"
                               Value="{Binding ViewModel.MinFileSize, Mode=TwoWay}"
                               Minimum="0"
                               SpinButtonPlacementMode="Inline"
                               IsEnabled="False" />

                    <ComboBox Header="Hash algorithm (coming soon)"
                              SelectedItem="{Binding ViewModel.SelectedHashAlgorithm, Mode=TwoWay}"
                              IsEnabled="False">
                        <ComboBoxItem Content="xxHash64" />
                        <ComboBoxItem Content="SHA-256" />
                    </ComboBox>

                    <ToggleSwitch Header="Include hidden files"
                                  IsOn="{Binding ViewModel.IncludeHiddenFiles, Mode=TwoWay}" />

                    <Slider Header="CPU threads (coming soon)"
                            Value="{Binding ViewModel.CpuThreads, Mode=TwoWay}"
                            Minimum="1"
                            Maximum="32"
                            StepFrequency="1"
                            TickFrequency="4"
                            TickPlacement="Outside"
                            IsEnabled="False" />

                    <TextBlock Text="Exclusion patterns:"
                               Style="{StaticResource BodyTextBlockStyle}" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox Text="{Binding ViewModel.NewIgnorePattern, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="e.g. **/node_modules/**"
                                 MinWidth="280" />
                        <Button Content="Add" Command="{Binding ViewModel.AddIgnorePatternCommand, Mode=OneTime}" />
                    </StackPanel>
                    <ItemsRepeater ItemsSource="{Binding ViewModel.IgnorePatterns, Mode=OneTime}">
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnSpacing="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding}" FontFamily="Consolas" FontSize="12"
                                               VerticalAlignment="Center" />
                                    <Button Grid.Column="1"
                                            Click="RemoveIgnorePattern_Click"
                                            Background="Transparent" BorderThickness="0"
                                            Padding="4" VerticalAlignment="Center"
                                            ToolTipService.ToolTip="Remove">
                                        <FontIcon Glyph="&#xE711;" FontSize="12" />
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </StackPanel>
            </ScrollViewer>
        </PivotItem>

        <!-- Step 3: Confirm -->
        <PivotItem Header="3 · Confirm">
            <ScrollViewer Padding="0,8">
                <StackPanel Spacing="16">
                    <TextBlock x:Name="ConfirmSummaryText"
                               Style="{StaticResource BodyTextBlockStyle}"
                               TextWrapping="Wrap" />

                    <StackPanel Spacing="8">
                        <TextBlock Text="Save as profile (optional):"
                                   Style="{StaticResource BodyTextBlockStyle}" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBox Text="{Binding ViewModel.ProfileName, Mode=TwoWay}"
                                     PlaceholderText="Profile name..."
                                     MinWidth="200" />
                            <Button Content="Save profile"
                                    IsEnabled="{Binding ViewModel.CanSaveProfile, Mode=OneWay}" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </PivotItem>
        </Pivot>

        <!-- Scan progress overlay — shown when IsScanning=true -->
        <controls:ScanProgressOverlay
            x:Name="ProgressOverlay"
            Visibility="{Binding ViewModel.IsScanning, Mode=OneWay}"
            VerticalAlignment="Stretch"
            HorizontalAlignment="Stretch"
            Canvas.ZIndex="10" />
    </Grid>
</ContentDialog>
